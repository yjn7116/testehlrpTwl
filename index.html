<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>실시간 토론</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f7f7f7;
    }

    .container {
      display: flex;
      justify-content: center;
    }

    .content {
      width: 50%;
      min-width: 300px;
      background: white;
      margin: 20px 0;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    #comments {
      margin-bottom: 20px;
    }

    .comment {
      padding: 10px;
      margin: 8px 0;
      border-radius: 10px;
      max-width: 70%;
      clear: both;
    }

    .agree {
      background-color: #d4fcdc;
      float: right;
      text-align: right;
    }

    .disagree {
      background-color: #ffd6d6;
      float: left;
      text-align: left;
    }

    input, textarea, button {
      width: 100%;
      margin-top: 8px;
      padding: 8px;
      box-sizing: border-box;
    }

    .buttons {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .buttons button {
      flex: 1;
      padding: 10px;
      font-size: 16px;
    }

    .nickname-box {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="content">
      <h1>당신은 이 주제에 찬성인가요, 반대인가요?</h1>

      <div id="comments"></div>

      <div class="nickname-box">
        <input type="text" id="nickname" placeholder="닉네임 (기본값: 최)">
      </div>
      <textarea id="comment" placeholder="댓글을 입력하세요"></textarea>
      <div class="buttons">
        <button id="agreeBtn" style="background-color: #c6f6d5;">찬성</button>
        <button id="disagreeBtn" style="background-color: #feb2b2;">반대</button>
      </div>
    </div>
  </div>

  <!-- UI 스크립트 -->
  <script>
    const nicknameInput = document.getElementById('nickname');
    const commentInput = document.getElementById('comment');
    const agreeBtn = document.getElementById('agreeBtn');
    const disagreeBtn = document.getElementById('disagreeBtn');

    let db;
    window.setDatabase = function(firebaseDb) {
      db = firebaseDb;
    }

    function postComment(position) {
      const nickname = nicknameInput.value.trim() || '최';
      const comment = commentInput.value.trim();
      if (!comment) return;

      const newComment = {
        nickname,
        comment,
        position,
        timestamp: Date.now()
      };

      if (db) {
        const { ref, push } = window.firebaseFns;
        push(ref(db, 'comments'), newComment);
      }

      commentInput.value = '';
    }

    agreeBtn.onclick = () => postComment('agree');
    disagreeBtn.onclick = () => postComment('disagree');
  </script>

  <!-- Firebase 스크립트 -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import {
      getDatabase,
      ref,
      onValue,
      push
    } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCFq__DB_6TnNVUG4Z3De7vpRnxynn8MjE",
      authDomain: "debateshop-cbeb4.firebaseapp.com",
      databaseURL: "https://debateshop-cbeb4-default-rtdb.firebaseio.com",
      projectId: "debateshop-cbeb4",
      storageBucket: "debateshop-cbeb4.firebasestorage.app",
      messagingSenderId: "460568591399",
      appId: "1:460568591399:web:e462862283d9ee69e16202"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.setDatabase(db);
    window.firebaseFns = { ref, push };

    const commentsContainer = document.getElementById('comments');

    onValue(ref(db, 'comments'), (snapshot) => {
      commentsContainer.innerHTML = '';
      const data = snapshot.val();
      if (!data) return;

      Object.values(data).forEach(comment => {
        const div = document.createElement('div');
        div.classList.add('comment');
        div.classList.add(comment.position === 'agree' ? 'agree' : 'disagree');
        div.innerHTML = `<strong>${comment.nickname}</strong>: ${comment.comment}`;
        commentsContainer.appendChild(div);
      });
    });
  </script>
</body>
</html>